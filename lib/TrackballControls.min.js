THREE.TrackballControls=function(e,t){function o(e){u.enabled!==!1&&(window.removeEventListener("keydown",o),y=g,g===E.NONE&&(e.keyCode!==u.keys[E.ROTATE]||u.noRotate?e.keyCode!==u.keys[E.ZOOM]||u.noZoom?e.keyCode!==u.keys[E.PAN]||u.noPan||(g=E.PAN):g=E.ZOOM:g=E.ROTATE))}function n(){u.enabled!==!1&&(g=y,window.addEventListener("keydown",o,!1))}function s(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),g===E.NONE&&(g=e.button),g!==E.ROTATE||u.noRotate?g!==E.ZOOM||u.noZoom?g!==E.PAN||u.noPan||(V.copy(D(e.pageX,e.pageY)),k.copy(V)):(O.copy(D(e.pageX,e.pageY)),R.copy(O)):(T.copy(Y(e.pageX,e.pageY)),w.copy(T)),document.addEventListener("mousemove",c,!1),document.addEventListener("mouseup",i,!1),u.dispatchEvent(j))}function c(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),g!==E.ROTATE||u.noRotate?g!==E.ZOOM||u.noZoom?g!==E.PAN||u.noPan||k.copy(D(e.pageX,e.pageY)):R.copy(D(e.pageX,e.pageY)):(w.copy(T),T.copy(Y(e.pageX,e.pageY))))}function i(e){u.enabled!==!1&&(e.preventDefault(),e.stopPropagation(),g=E.NONE,document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",i),u.dispatchEvent(A))}function a(e){if(u.enabled!==!1){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:O.y-=.025*e.deltaY;break;case 1:O.y-=.01*e.deltaY;break;default:O.y-=25e-5*e.deltaY}u.dispatchEvent(j),u.dispatchEvent(A)}}function r(e){if(u.enabled!==!1){switch(e.touches.length){case 1:g=E.TOUCH_ROTATE,T.copy(Y(e.touches[0].pageX,e.touches[0].pageY)),w.copy(T);break;default:g=E.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;L=H=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;V.copy(D(n,s)),k.copy(V)}u.dispatchEvent(j)}}function p(e){if(u.enabled!==!1)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:w.copy(T),T.copy(Y(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;L=Math.sqrt(t*t+o*o);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,s=(e.touches[0].pageY+e.touches[1].pageY)/2;k.copy(D(n,s))}}function h(e){if(u.enabled!==!1){switch(e.touches.length){case 0:g=E.NONE;break;case 1:g=E.TOUCH_ROTATE,T.copy(Y(e.touches[0].pageX,e.touches[0].pageY)),w.copy(T)}u.dispatchEvent(A)}}function d(e){e.preventDefault()}var u=this,E={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new THREE.Vector3;var m=1e-6,l=new THREE.Vector3,g=E.NONE,y=E.NONE,v=new THREE.Vector3,w=new THREE.Vector2,T=new THREE.Vector2,f=new THREE.Vector3,b=0,O=new THREE.Vector2,R=new THREE.Vector2,H=0,L=0,V=new THREE.Vector2,k=new THREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var N={type:"change"},j={type:"start"},A={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}},this.handleEvent=function(e){"function"==typeof this[e.type]&&this[e.type](e)};var D=function(){var e=new THREE.Vector2;return function(t,o){return e.set((t-u.screen.left)/u.screen.width,(o-u.screen.top)/u.screen.height),e}}(),Y=function(){var e=new THREE.Vector2;return function(t,o){return e.set((t-.5*u.screen.width-u.screen.left)/(.5*u.screen.width),(u.screen.height+2*(u.screen.top-o))/u.screen.width),e}}();this.rotateCamera=function(){var e,t=new THREE.Vector3,o=new THREE.Quaternion,n=new THREE.Vector3,s=new THREE.Vector3,c=new THREE.Vector3,i=new THREE.Vector3;return function(){i.set(T.x-w.x,T.y-w.y,0),e=i.length(),e?(v.copy(u.object.position).sub(u.target),n.copy(v).normalize(),s.copy(u.object.up).normalize(),c.crossVectors(s,n).normalize(),s.setLength(T.y-w.y),c.setLength(T.x-w.x),i.copy(s.add(c)),t.crossVectors(i,v).normalize(),e*=u.rotateSpeed,o.setFromAxisAngle(t,e),v.applyQuaternion(o),u.object.up.applyQuaternion(o),f.copy(t),b=e):!u.staticMoving&&b&&(b*=Math.sqrt(1-u.dynamicDampingFactor),v.copy(u.object.position).sub(u.target),o.setFromAxisAngle(f,b),v.applyQuaternion(o),u.object.up.applyQuaternion(o)),w.copy(T)}}(),this.zoomCamera=function(){var e;g===E.TOUCH_ZOOM_PAN?(e=H/L,H=L,v.multiplyScalar(e)):(e=1+(R.y-O.y)*u.zoomSpeed,1!==e&&e>0&&v.multiplyScalar(e),u.staticMoving?O.copy(R):O.y+=(R.y-O.y)*this.dynamicDampingFactor)},this.panCamera=function(){var e=new THREE.Vector2,t=new THREE.Vector3,o=new THREE.Vector3;return function(){e.copy(k).sub(V),e.lengthSq()&&(e.multiplyScalar(v.length()*u.panSpeed),o.copy(v).cross(u.object.up).setLength(e.x),o.add(t.copy(u.object.up).setLength(e.y)),u.object.position.add(o),u.target.add(o),u.staticMoving?V.copy(k):V.add(e.subVectors(k,V).multiplyScalar(u.dynamicDampingFactor)))}}(),this.checkDistances=function(){u.noZoom&&u.noPan||(v.lengthSq()>u.maxDistance*u.maxDistance&&(u.object.position.addVectors(u.target,v.setLength(u.maxDistance)),O.copy(R)),v.lengthSq()<u.minDistance*u.minDistance&&(u.object.position.addVectors(u.target,v.setLength(u.minDistance)),O.copy(R)))},this.update=function(){v.subVectors(u.object.position,u.target),u.noRotate||u.rotateCamera(),u.noZoom||u.zoomCamera(),u.noPan||u.panCamera(),u.object.position.addVectors(u.target,v),u.checkDistances(),u.object.lookAt(u.target),l.distanceToSquared(u.object.position)>m&&(u.dispatchEvent(N),l.copy(u.object.position))},this.reset=function(){g=E.NONE,y=E.NONE,u.target.copy(u.target0),u.object.position.copy(u.position0),u.object.up.copy(u.up0),v.subVectors(u.object.position,u.target),u.object.lookAt(u.target),u.dispatchEvent(N),l.copy(u.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",d,!1),this.domElement.removeEventListener("mousedown",s,!1),this.domElement.removeEventListener("wheel",a,!1),this.domElement.removeEventListener("touchstart",r,!1),this.domElement.removeEventListener("touchend",h,!1),this.domElement.removeEventListener("touchmove",p,!1),document.removeEventListener("mousemove",c,!1),document.removeEventListener("mouseup",i,!1),window.removeEventListener("keydown",o,!1),window.removeEventListener("keyup",n,!1)},this.domElement.addEventListener("contextmenu",d,!1),this.domElement.addEventListener("mousedown",s,!1),this.domElement.addEventListener("wheel",a,!1),this.domElement.addEventListener("touchstart",r,!1),this.domElement.addEventListener("touchend",h,!1),this.domElement.addEventListener("touchmove",p,!1),window.addEventListener("keydown",o,!1),window.addEventListener("keyup",n,!1),this.handleResize(),this.update()},THREE.TrackballControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.TrackballControls.prototype.constructor=THREE.TrackballControls;